<!doctype html>
<head><meta charset="utf-8">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/github.min.css">
<script src="https://bterlson.github.io/ecmarkup/ecmarkup.js"></script>
<link rel="stylesheet" href="https://bterlson.github.io/ecmarkup/elements.css">
<title>ECMAScript Frozen Realms Spec Proposal</title><script type="application/json" id="menu-search-biblio">[{"type":"clause","id":"sec-realms-objects","aoid":null,"title":"Realms Objects","number":"1","namespace":"https://rawgit.com/FUDCo/frozen-realms/master/index.html","location":"","key":"Realms Objects"},{"type":"clause","id":"sec-realms-abstracts","aoid":null,"title":"Abstract Operations","number":"1.1","namespace":"https://rawgit.com/FUDCo/frozen-realms/master/index.html","location":"","key":"Abstract Operations"},{"type":"op","aoid":"CreateSpawnRealm","refId":"sec-createspawnrealm","location":"","key":"CreateSpawnRealm"},{"type":"clause","id":"sec-createspawnrealm","aoid":"CreateSpawnRealm","title":"CreateSpawnRealm ( _parentRealmRec_ )","number":"1.1.1","namespace":"https://rawgit.com/FUDCo/frozen-realms/master/index.html","location":"","key":"CreateSpawnRealm ( _parentRealmRec_ )"},{"type":"op","aoid":"SetFrozenGlobalBindings","refId":"sec-setfrozenglobalbindings","location":"","key":"SetFrozenGlobalBindings"},{"type":"clause","id":"sec-setfrozenglobalbindings","aoid":"SetFrozenGlobalBindings","title":"SetFrozenGlobalBindings ( _realmRec_ )","number":"1.1.2","namespace":"https://rawgit.com/FUDCo/frozen-realms/master/index.html","location":"","key":"SetFrozenGlobalBindings ( _realmRec_ )"},{"type":"op","aoid":"FreezeRealmIntrinsics","refId":"sec-freezerealmintrinsics","location":"","key":"FreezeRealmIntrinsics"},{"type":"clause","id":"sec-freezerealmintrinsics","aoid":"FreezeRealmIntrinsics","title":"FreezeRealmIntrinsics ( _realmRec_ )","number":"1.1.3","namespace":"https://rawgit.com/FUDCo/frozen-realms/master/index.html","location":"","key":"FreezeRealmIntrinsics ( _realmRec_ )"},{"type":"clause","id":"sec-properties-of-the-realm-constructor","aoid":null,"title":"Properties of the Realm Constructor","number":"1.2","namespace":"https://rawgit.com/FUDCo/frozen-realms/master/index.html","location":"","key":"Properties of the Realm Constructor"},{"type":"clause","id":"sec-realm.immutableroot","aoid":null,"title":"Realm.immutableRoot ()","number":"1.2.1","namespace":"https://rawgit.com/FUDCo/frozen-realms/master/index.html","location":"","key":"Realm.immutableRoot ()"},{"type":"clause","id":"sec-properties-of-the-realm-prototype-object","aoid":null,"title":"Properties of the Realm Prototype Object","number":"1.3","namespace":"https://rawgit.com/FUDCo/frozen-realms/master/index.html","location":"","key":"Properties of the Realm Prototype Object"},{"type":"clause","id":"sec-realm-prototype-spawn","aoid":null,"title":"Realm.prototype.spawn ([ _endowments_ ])","number":"1.3.1","namespace":"https://rawgit.com/FUDCo/frozen-realms/master/index.html","location":"","key":"Realm.prototype.spawn ([ _endowments_ ])"}]</script></head><body><div id="menu-toggle">☰</div><div id="menu"><div id="menu-search"><input type="text" id="menu-search-box" placeholder="Search..."><div id="menu-search-results" class="inactive"></div></div><div id="menu-toc"><ol class="toc"><li><span class="item-toggle">◢</span><a href="#sec-realms-objects" title="Realms Objects"><span class="secnum">1</span> Realms Objects</a><ol class="toc"><li><span class="item-toggle">◢</span><a href="#sec-realms-abstracts" title="Abstract Operations"><span class="secnum">1.1</span> Abstract Operations</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-createspawnrealm" title="CreateSpawnRealm ( _parentRealmRec_ )"><span class="secnum">1.1.1</span> CreateSpawnRealm ( <var>parentRealmRec</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-setfrozenglobalbindings" title="SetFrozenGlobalBindings ( _realmRec_ )"><span class="secnum">1.1.2</span> SetFrozenGlobalBindings ( <var>realmRec</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-freezerealmintrinsics" title="FreezeRealmIntrinsics ( _realmRec_ )"><span class="secnum">1.1.3</span> FreezeRealmIntrinsics ( <var>realmRec</var> )</a></li></ol></li><li><span class="item-toggle">◢</span><a href="#sec-properties-of-the-realm-constructor" title="Properties of the Realm Constructor"><span class="secnum">1.2</span> Properties of the Realm Constructor</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-realm.immutableroot" title="Realm.immutableRoot ()"><span class="secnum">1.2.1</span> Realm.immutableRoot ()</a></li></ol></li><li><span class="item-toggle">◢</span><a href="#sec-properties-of-the-realm-prototype-object" title="Properties of the Realm Prototype Object"><span class="secnum">1.3</span> Properties of the Realm Prototype Object</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-realm-prototype-spawn" title="Realm.prototype.spawn ([ _endowments_ ])"><span class="secnum">1.3.1</span> Realm.prototype.spawn ([ <var>endowments</var> ])</a></li></ol></li></ol></li></ol></div></div><h1 class="version">May 10, 2016</h1><h1 class="title">ECMAScript Frozen Realms Spec Proposal</h1>

<emu-clause id="sec-realms-objects">
    <h1><span class="secnum">1</span>Realms Objects<span class="utils"><span class="anchor"><a href="#sec-realms-objects">#</a></span></span></h1>

    <emu-note><span class="note">Note</span>
      <emu-val>IMPORTANT</emu-val> this section references the <emu-xref href="#realm"><a href="https://tc39.github.io/ecma262/#realm">Realm</a></emu-xref> API  <a href="https://github.com/caridy/proposal-realms">spec proposal</a>, specifically, it adds new capabilities to the <emu-xref href="#realm"><a href="https://tc39.github.io/ecma262/#realm">Realm</a></emu-xref> Objects.
    
    </emu-note>

    <emu-clause id="sec-realms-abstracts">
        <h1><span class="secnum">1.1</span>Abstract Operations<span class="utils"><span class="anchor"><a href="#sec-realms-abstracts">#</a></span></span></h1>

        <emu-clause id="sec-createspawnrealm" aoid="CreateSpawnRealm">
            <h1><span class="secnum">1.1.1</span>CreateSpawnRealm ( <var>parentRealmRec</var> )<span class="utils"><span class="anchor"><a href="#sec-createspawnrealm">#</a></span></span></h1>

            The abstract operation <emu-val>CreateSpawnRealm</emu-val> with argument <var>parentRealmRec</var> performs the following steps: 

            <emu-alg><ol><li>Assert: <var>parentRealmRec</var> is a <emu-xref href="#realm-record"><a href="https://tc39.github.io/ecma262/#realm-record">Realm Record</a></emu-xref>.</li><li>Let intrinsics be <var>parentRealm</var>.[[Intrinsics]].</li><li>Let <var>realmRec</var> be a new <emu-xref href="#realm-record"><a href="https://tc39.github.io/ecma262/#realm-record">Realm Record</a></emu-xref>.</li><li>Set <var>realmRec</var>.[[Intrinsics]] to <var>intrinsics</var>.</li><li>Let <var>freshObject</var> to <emu-xref aoid="ObjectCreate"><a href="https://tc39.github.io/ecma262/#sec-objectcreate">ObjectCreate</a></emu-xref>(<var>parentRealm</var>.[[GlobalObject]]).</li><li>Perform ? <emu-xref aoid="SetRealmGlobalObject"><a href="https://tc39.github.io/ecma262/#sec-setrealmglobalobject">SetRealmGlobalObject</a></emu-xref>(<var>realmRec</var>, <var>freshObject</var>, <emu-val>undefined</emu-val>).</li><li>Set realmRec.[[TemplateMap]] to a new empty <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.github.io/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref>.</li><li>Return <var>realmRec</var>.
            </li></ol></emu-alg>

        </emu-clause>

        <emu-clause id="sec-setfrozenglobalbindings" aoid="SetFrozenGlobalBindings">
            <h1><span class="secnum">1.1.2</span>SetFrozenGlobalBindings ( <var>realmRec</var> )<span class="utils"><span class="anchor"><a href="#sec-setfrozenglobalbindings">#</a></span></span></h1>

            The abstract operation <emu-val>SetFrozenGlobalBindings</emu-val> with argument <var>realmRec</var> performs the following steps: 

            <emu-alg><ol><li>Assert: <var>realmRec</var> is a <emu-xref href="#realm-record"><a href="https://tc39.github.io/ecma262/#realm-record">Realm Record</a></emu-xref>.</li><li>Let <var>global</var> be <var>realmRec</var>.[[GlobalObject]].</li><li>For each property of the Global Object specified in clause <emu-xref href="#sec-global-object"><a href="https://tc39.github.io/ecma262/#sec-global-object">18</a></emu-xref>, do<ol><li>Let <var>name</var> be the String value of the property name.</li><li>Let <var>desc</var> be the fully populated data property descriptor for the immutable property containing the specified attributes for the property. For properties listed in <emu-xref href="#sec-function-properties-of-the-global-object"><a href="https://tc39.github.io/ecma262/#sec-function-properties-of-the-global-object">18.2</a></emu-xref>, <emu-xref href="#sec-constructor-properties-of-the-global-object"><a href="https://tc39.github.io/ecma262/#sec-constructor-properties-of-the-global-object">18.3</a></emu-xref>, or <emu-xref href="#sec-other-properties-of-the-global-object"><a href="https://tc39.github.io/ecma262/#sec-other-properties-of-the-global-object">18.4</a></emu-xref> the value of the [[Value]] attribute is the corresponding intrinsic object from <var>realmRec</var>.</li><li>Perform ? <emu-xref aoid="DefinePropertyOrThrow"><a href="https://tc39.github.io/ecma262/#sec-definepropertyorthrow">DefinePropertyOrThrow</a></emu-xref>(<var>global</var>, <var>name</var>, <var>desc</var>).</li></ol></li><li>Return <var>global</var>.
            </li></ol></emu-alg>

            <emu-note><span class="note">Note</span>
              These primordials include <emu-val>all</emu-val> the primordials defined as mandatory in ES2017. These primordials must include no other objects or properties beyond those specified here.
            
            </emu-note>

        </emu-clause>

        <emu-clause id="sec-freezerealmintrinsics" aoid="FreezeRealmIntrinsics">
            <h1><span class="secnum">1.1.3</span>FreezeRealmIntrinsics ( <var>realmRec</var> )<span class="utils"><span class="anchor"><a href="#sec-freezerealmintrinsics">#</a></span></span></h1>

            The abstract operation <emu-val>FreezeRealmIntrinsics</emu-val> with argument <var>realmRec</var> performs the following steps: 

            <emu-alg><ol><li>Assert: <var>realmRec</var> is a <emu-xref href="#realm-record"><a href="https://tc39.github.io/ecma262/#realm-record">Realm Record</a></emu-xref>.</li><li>Let <var>intrinsics</var> be <var><emu-xref href="#realm"><a href="https://tc39.github.io/ecma262/#realm">realm</a></emu-xref></var>.[[Intrinsics]].</li><li>Let <var>DatePrototype</var> be <var>intrinsics</var>.[[<emu-xref href="#sec-properties-of-the-date-prototype-object"><a href="https://tc39.github.io/ecma262/#sec-properties-of-the-date-prototype-object">%DatePrototype%</a></emu-xref>]].</li><li>Perform ? <emu-xref aoid="CreateMethodProperty"><a href="https://tc39.github.io/ecma262/#sec-createmethodproperty">CreateMethodProperty</a></emu-xref> (<var>DatePrototype</var>, <emu-val>"now"</emu-val>, <emu-val>undefined</emu-val>).</li><li>Let <var>Math</var> be <var>intrinsics</var>.[[<emu-xref href="#sec-math-object"><a href="https://tc39.github.io/ecma262/#sec-math-object">%Math%</a></emu-xref>]].</li><li>Perform ? <emu-xref aoid="CreateMethodProperty"><a href="https://tc39.github.io/ecma262/#sec-createmethodproperty">CreateMethodProperty</a></emu-xref> (<var>Math</var>, <emu-val>"random"</emu-val>, <emu-val>undefined</emu-val>).</li><li>For each <var>value</var> corresponding to a field name in <var>intrinsics</var>, do:<ol><li>Perform ? <emu-xref aoid="SetIntegrityLevel"><a href="https://tc39.github.io/ecma262/#sec-setintegritylevel">SetIntegrityLevel</a></emu-xref>(<var>value</var>, "frozen") and make the <var>value</var> object transitively immutable.</li></ol></li><li>Return <var>intrinsics</var>.
            </li></ol></emu-alg>

            <emu-note><span class="note">Note</span>
              In order to attain the necessary deep immutability of an immutable root <emu-xref href="#realm"><a href="https://tc39.github.io/ecma262/#realm">realm</a></emu-xref>, two of its primordials must be modified from the existing standard: An immutable root <emu-xref href="#realm"><a href="https://tc39.github.io/ecma262/#realm">realm</a></emu-xref>'s <code>Date</code> object has its <code>now()</code> method removed and the Date Constructor should throw a <code>TypeError</code> when called as a constructor or a function, rather than reveal the current time. An immutable root <emu-xref href="#realm"><a href="https://tc39.github.io/ecma262/#realm">realm</a></emu-xref>'s <code>Math</code> object has its <code>random()</code> method removed.
            
            </emu-note>

        </emu-clause>
    </emu-clause>

    <emu-clause id="sec-properties-of-the-realm-constructor">
        <h1><span class="secnum">1.2</span>Properties of the Realm Constructor<span class="utils"><span class="anchor"><a href="#sec-properties-of-the-realm-constructor">#</a></span></span></h1>

        The value of the [[Prototype]] internal slot of the <emu-val><emu-xref href="#realm"><a href="https://tc39.github.io/ecma262/#realm">Realm</a></emu-xref></emu-val> constructor is the intrinsic object <emu-xref href="#sec-properties-of-the-function-constructor"><a href="https://tc39.github.io/ecma262/#sec-properties-of-the-function-constructor">%FunctionPrototype%</a></emu-xref>. 

        <emu-clause id="sec-realm.immutableroot">
            <h1><span class="secnum">1.2.1</span>Realm.immutableRoot ()<span class="utils"><span class="anchor"><a href="#sec-realm.immutableroot">#</a></span></span></h1>

            When the <emu-val>Realm.immutableRoot</emu-val> function is called with no arguments, the following steps are taken: 

            <emu-alg><ol><li>If NewTarget is <emu-val>undefined</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>O</var> be ? <emu-xref aoid="OrdinaryCreateFromConstructor"><a href="https://tc39.github.io/ecma262/#sec-ordinarycreatefromconstructor">OrdinaryCreateFromConstructor</a></emu-xref>(NewTarget, "%RealmPrototype%", « [[Realm]] »).</li><li>Let <var>realmRec</var> be <emu-xref aoid="CreateRealm"><a href="https://tc39.github.io/ecma262/#sec-createrealm">CreateRealm</a></emu-xref>().</li><li>Set <var>O</var>'s [[Realm]] internal slot to <var>realmRec</var>.</li><li>Perform ? ExtractRealmMethods(<var>O</var>).</li><li>Perform ? <emu-xref aoid="SetRealmGlobalObject"><a href="https://tc39.github.io/ecma262/#sec-setrealmglobalobject">SetRealmGlobalObject</a></emu-xref>(<var>realmRec</var>, <emu-val>undefined</emu-val>, <emu-val>undefined</emu-val>).</li><li>Perform ? <emu-xref aoid="FreezeRealmIntrinsics"><a href="#sec-freezerealmintrinsics">FreezeRealmIntrinsics</a></emu-xref>(<var>realmRec</var>).</li><li>Let <var>globalObject</var> be ? <emu-xref aoid="SetFrozenGlobalBindings"><a href="#sec-setfrozenglobalbindings">SetFrozenGlobalBindings</a></emu-xref>(<var>realmRec</var>).</li><li>Perform ? <emu-xref aoid="SetIntegrityLevel"><a href="https://tc39.github.io/ecma262/#sec-setintegritylevel">SetIntegrityLevel</a></emu-xref>(<var>globalObject</var>, "frozen").</li><li>Return <var>O</var>.
            </li></ol></emu-alg>

            <emu-note><span class="note">Note 1</span>
              <code>Realm.immutableRoot()</code> obtains an  <def>immutable root <emu-xref href="#realm"><a href="https://tc39.github.io/ecma262/#realm">realm</a></emu-xref></def> in which all primordials are already transitively immutable. These primordials must include no other objects or properties beyond those specified here. In an immutable root <emu-xref href="#realm"><a href="https://tc39.github.io/ecma262/#realm">realm</a></emu-xref> the <emu-xref href="#global-object"><a href="https://tc39.github.io/ecma262/#global-object">global object</a></emu-xref> itself is also transitively immutable. Specifically, it contains no host-specific objects. This frozen <emu-xref href="#global-object"><a href="https://tc39.github.io/ecma262/#global-object">global object</a></emu-xref> is a plain object whose <code>[[Prototype]]</code> is <code>Object.prototype</code>, i.e., the <code>%ObjectPrototype%</code> intrinsic of that immutable root <emu-xref href="#realm"><a href="https://tc39.github.io/ecma262/#realm">realm</a></emu-xref>.
            
            </emu-note>

            <emu-note><span class="note">Note 2</span>
              Since two immutable root realms are forever the same in all ways except object identity, we leave it implementation-defined whether <code>Realm.immutableRoot()</code> always creates a fresh one, or always returns the same one. On any given implementation, it must either be always fresh or always the same.
            
            </emu-note>
        </emu-clause>

    </emu-clause>

    <emu-clause id="sec-properties-of-the-realm-prototype-object">
        <h1><span class="secnum">1.3</span>Properties of the Realm Prototype Object<span class="utils"><span class="anchor"><a href="#sec-properties-of-the-realm-prototype-object">#</a></span></span></h1>

        <emu-clause id="sec-realm-prototype-spawn">
              <h1><span class="secnum">1.3.1</span>Realm.prototype.spawn ([ <var>endowments</var> ])<span class="utils"><span class="anchor"><a href="#sec-realm-prototype-spawn">#</a></span></span></h1>

              When the <emu-val>Realm.prototype.spawn</emu-val> function is called with optional argument <var>endowments</var>, the following steps are taken: 

              <emu-alg><ol><li>Let <var>parentRealmObj</var> be <emu-val>this</emu-val> value.</li><li>If <emu-xref aoid="Type"><a href="https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values">Type</a></emu-xref>(<var>parentRealmObj</var>) is not Object, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>parentRealmObj</var> is not an instance of a concrete subclass of <emu-xref href="#realm"><a href="https://tc39.github.io/ecma262/#realm">Realm</a></emu-xref>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>O</var> be ? <emu-xref aoid="ObjectCreate"><a href="https://tc39.github.io/ecma262/#sec-objectcreate">ObjectCreate</a></emu-xref>(<var>parentRealmObj</var>, « [[Realm]] »).</li><li>Let <var>realmRec</var> be ? <emu-xref aoid="CreateSpawnRealm"><a href="#sec-createspawnrealm">CreateSpawnRealm</a></emu-xref>(<var>parentRealmObj</var>.[[Realm]]).</li><li>Set <var>O</var>'s [[Realm]] internal slot to <var>realmRec</var>.</li><li>If <var>endowments</var> is provided, then<ol><li>If <emu-xref aoid="Type"><a href="https://tc39.github.io/ecma262/#sec-ecmascript-data-types-and-values">Type</a></emu-xref>(<var>endowments</var>) is not an Object, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>globalObject</var> be <var>realmRec</var>.[[GlobalObject]].</li><li>Let <var>props</var> be ? <emu-xref aoid="ToObject"><a href="https://tc39.github.io/ecma262/#sec-toobject">ToObject</a></emu-xref>(<var>endowments</var>).</li><li>Let <var>keys</var> be ? <var>props</var>.[[OwnPropertyKeys]]().</li><li>Repeat for each element <var>propName</var> of keys in <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.github.io/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> order,<ol><li>Let <var>propDesc</var> be ? <var>props</var>.[[GetOwnProperty]](<var>propName</var>).</li><li>If <var>propDesc</var> is not <emu-val>undefined</emu-val> and <var>propDesc</var>.[[Enumerable]] is <emu-val>true</emu-val>, then<ol><li>Let <var>propValue</var> be ? <emu-xref aoid="Get"><a href="https://tc39.github.io/ecma262/#sec-get-o-p">Get</a></emu-xref>(<var>props</var>, <var>propName</var>).</li><li>Perform ? <emu-xref aoid="CreateDataPropertyOrThrow"><a href="https://tc39.github.io/ecma262/#sec-createdatapropertyorthrow">CreateDataPropertyOrThrow</a></emu-xref>(<var>globalObject</var>, <var>propName</var>, <var>propValue</var>).</li></ol></li></ol></li></ol></li><li>Return <var>O</var>.
              </li></ol></emu-alg>
        </emu-clause>

    </emu-clause>

</emu-clause>
</body>